import { defineComponent as Q, ref as f, computed as B, watch as j, onMounted as J, onBeforeUnmount as X, openBlock as a, createBlock as M, unref as m, withCtx as g, createElementVNode as p, createVNode as C, createTextVNode as N, createElementBlock as i, withKeys as P, withModifiers as I, Fragment as R, renderList as T, withDirectives as Y, toDisplayString as U, vShow as Z, normalizeClass as ee, createCommentVNode as oe, resolveDynamicComponent as te, mergeProps as ne, nextTick as A } from "vue";
import { Dialog as ae, DialogPanel as le, DialogTitle as se } from "@headlessui/vue";
import { useModal as re, ScalarIcon as D } from "@scalar/components";
import { useRouter as me } from "vue-router";
import { ROUTES as ie } from "../../constants.js";
import { importCurlCommand as ce } from "../../libs/importers/curl.js";
import { PathId as ue } from "../../routes.js";
import { useActiveEntities as de } from "../../store/active-entities.js";
import fe from "./CommandPaletteCollection.vue.js";
import pe from "./CommandPaletteExample.vue.js";
import ve from "./CommandPaletteImport.vue.js";
import Ce from "./CommandPaletteImportCurl.vue.js";
import he from "./CommandPaletteServer.vue.js";
import xe from "./CommandPaletteTag.vue.js";
import ke from "./CommandPaletteWorkspace.vue.js";
import { useWorkspace as be } from "../../store/store.js";
const _e = {
  key: 0,
  class: "custom-scroll max-h-[50dvh] min-h-0 flex-1 rounded-lg p-1.5"
}, ye = { class: "bg-b-2 focus-within:bg-b-1 focus-within:border-b-3 sticky top-0 flex items-center rounded-md border border-transparent pl-2 shadow-[0_-8px_0_8px_var(--scalar-background-1),0_0_8px_8px_var(--scalar-background-1)]" }, we = { for: "commandmenu" }, ge = ["value", "onKeydown"], Pe = ["onClick"], Ie = {
  key: 0,
  class: "text-c-3 p-2 pt-3 text-center text-sm"
}, Re = {
  key: 1,
  class: "flex-1 p-1.5"
}, Ae = {
  name: "TheCommandPalette"
}, De = {
  "Import from OpenAPI/Swagger/Postman/cURL": ve,
  "Create Request": "",
  "Create Workspace": ke,
  "Add Tag": xe,
  "Add Server": he,
  "Create Collection": fe,
  "Add Example": pe,
  "Import from cURL": Ce
}, Ge = /* @__PURE__ */ Q({
  ...Ae,
  setup(Le) {
    const v = re(), k = me(), { activeWorkspace: h, activeWorkspaceCollections: W, activeCollection: V } = de(), { events: c, requestMutators: H } = be(), L = [
      {
        label: "",
        commands: [
          {
            name: "Import from OpenAPI/Swagger/Postman/cURL",
            icon: "Import"
          },
          {
            name: "Create Request",
            icon: "ExternalLink"
          },
          {
            name: "Create Collection",
            icon: "Collection"
          },
          {
            name: "Add Tag",
            icon: "Folder"
          },
          {
            name: "Add Example",
            icon: "Example"
          },
          {
            name: "Add Server",
            icon: "Server"
          }
        ]
      },
      {
        label: "More Actions",
        commands: [
          {
            name: "Create Workspace",
            icon: "Workspace"
          },
          {
            name: "Add Environment",
            icon: "Brackets",
            path: "environment.default"
          },
          {
            name: "Add Cookie",
            icon: "Cookie",
            path: "cookies.default"
          }
        ]
      },
      {
        label: "Pages",
        commands: ie.map((o) => {
          var e;
          return {
            name: o.displayName,
            icon: o.icon,
            path: k.resolve({
              ...o.to,
              params: {
                [ue.Workspace]: ((e = h == null ? void 0 : h.value) == null ? void 0 : e.uid) ?? "default"
              }
            }).href
          };
        })
      }
    ], b = f(), l = f(""), s = f(null), u = f(-1), S = f([]), x = B(
      () => L.reduce((o, e) => {
        const t = e.commands.filter(
          (n) => n.name.toLowerCase().includes(l.value.toLowerCase())
        );
        return [...o, ...t];
      }, [])
    ), d = () => {
      v.hide(), l.value = "", s.value = null, u.value = -1;
    }, O = (o) => {
      l.value !== "" && (o == null || o.preventDefault()), s.value = null, A(() => {
        var e;
        return (e = _.value) == null ? void 0 : e.focus();
      });
    }, E = (o) => {
      var e;
      if ("path" in o)
        k.push(o.path), d();
      else if (o.name === "Create Request") {
        const t = W.value.find(
          (n) => {
            var r;
            return ((r = n.info) == null ? void 0 : r.title) === "Drafts";
          }
        );
        if (t) {
          const n = H.add({}, t.uid);
          n && (k.push({
            name: "request",
            params: {
              workspace: (e = h.value) == null ? void 0 : e.uid,
              request: n.uid
            }
          }), d(), A(() => {
            c.hotKeys.emit({
              focusAddressBar: new KeyboardEvent("keydown", { key: "l" })
            });
          }));
        } else
          d();
      } else
        s.value = o.name;
    }, _ = f(), K = ({
      commandName: o,
      metaData: e
    } = {}) => {
      s.value = o ?? null, b.value = e, v.show(), A(() => {
        var t;
        return (t = _.value) == null ? void 0 : t.focus();
      });
    };
    j(l, (o) => {
      o && x.value.length > 0 && (u.value = 0);
    });
    const $ = (o, e) => {
      var r;
      if (!v.open) return;
      e.preventDefault();
      const t = o === "up" ? -1 : 1, n = x.value.length;
      u.value = (u.value + t + n) % n, (r = S.value[u.value]) == null || r.scrollIntoView({
        behavior: "smooth",
        block: "nearest"
      });
    }, y = B(
      () => x.value[u.value]
    ), F = (o) => {
      !y.value || s.value || (o.preventDefault(), o.stopPropagation(), E(y.value));
    }, q = (o) => {
      v.open && o != null && o.closeModal && d();
    }, G = (o) => {
      var e;
      if (o.trim().toLowerCase().startsWith("curl")) {
        c.commandPalette.emit({
          commandName: "Import from cURL",
          metaData: {
            parsedCurl: ce(o),
            collectionUid: (e = V.value) == null ? void 0 : e.uid
          }
        });
        return;
      }
      l.value = o;
    };
    return J(() => {
      c.commandPalette.on(K), c.hotKeys.on(q);
    }), X(() => {
      c.commandPalette.off(K), c.hotKeys.off(q);
    }), (o, e) => (a(), M(m(ae), {
      open: m(v).open,
      onClose: e[5] || (e[5] = (t) => d())
    }, {
      default: g(() => [
        e[7] || (e[7] = p("div", { class: "commandmenu-overlay z-overlay" }, null, -1)),
        C(m(le), { class: "commandmenu z-overlay flex flex-col" }, {
          default: g(() => [
            C(m(se), { class: "sr-only" }, {
              default: g(() => e[6] || (e[6] = [
                N("API Client Command Menu")
              ])),
              _: 1
            }),
            s.value ? (a(), i("div", Re, [
              p("button", {
                class: "hover:bg-b-3 text-c-3 active:text-c-1 z-1 my-1.25 p-0.75 absolute mr-1.5 rounded",
                type: "button",
                onClick: e[3] || (e[3] = (t) => s.value = null)
              }, [
                C(m(D), {
                  icon: "ChevronLeft",
                  size: "md",
                  thickness: "1.5"
                })
              ]),
              (a(), M(te(De[s.value]), ne(b.value ? { metaData: b.value } : {}, {
                onBack: e[4] || (e[4] = (t) => O(t)),
                onClose: d
              }), null, 16))
            ])) : (a(), i("div", _e, [
              p("div", ye, [
                p("label", we, [
                  C(m(D), {
                    class: "text-c-2 mr-2.5",
                    icon: "Search",
                    size: "md",
                    thickness: "1.5"
                  })
                ]),
                p("input", {
                  id: "commandmenu",
                  ref_key: "commandInputRef",
                  ref: _,
                  autocomplete: "off",
                  autofocus: "",
                  class: "w-full rounded border-none bg-none py-1.5 text-sm focus:outline-none",
                  placeholder: "Search commands...",
                  type: "text",
                  value: l.value,
                  onInput: e[0] || (e[0] = (t) => G(t.target.value)),
                  onKeydown: [
                    e[1] || (e[1] = P(I((t) => $("down", t), ["stop"]), ["down"])),
                    P(I(F, ["stop"]), ["enter"]),
                    e[2] || (e[2] = P(I((t) => $("up", t), ["stop"]), ["up"]))
                  ]
                }, null, 40, ge)
              ]),
              (a(), i(R, null, T(L, (t) => (a(), i(R, {
                key: t.label
              }, [
                Y(p("div", { class: "text-c-3 mb-1 mt-2 px-2 text-xs font-medium" }, U(t.label), 513), [
                  [
                    Z,
                    t.commands.filter(
                      (n) => n.name.toLowerCase().includes(l.value.toLowerCase())
                    ).length > 0
                  ]
                ]),
                (a(!0), i(R, null, T(t.commands.filter(
                  (n) => n.name.toLowerCase().includes(l.value.toLowerCase())
                ), (n, r) => {
                  var z;
                  return a(), i("div", {
                    key: n.name,
                    ref_for: !0,
                    ref: (w) => {
                      w && (S.value[r] = w);
                    },
                    class: ee(["commandmenu-item hover:bg-b-2 flex cursor-pointer items-center rounded px-2 py-1.5 text-sm", {
                      "bg-b-2": n.name === ((z = y.value) == null ? void 0 : z.name)
                    }]),
                    onClick: (w) => E(n)
                  }, [
                    C(m(D), {
                      class: "text-c-2 mr-2.5",
                      icon: n.icon,
                      size: "md",
                      thickness: "1.5"
                    }, null, 8, ["icon"]),
                    N(" " + U(n.name), 1)
                  ], 10, Pe);
                }), 128))
              ], 64))), 64)),
              x.value.length ? oe("", !0) : (a(), i("div", Ie, " No commands found "))
            ]))
          ]),
          _: 1
        })
      ]),
      _: 1
    }, 8, ["open"]));
  }
});
export {
  De as PaletteComponents,
  Ge as default
};
