import { defineComponent as O, computed as m, onMounted as T, ref as S, watch as N, openBlock as c, createBlock as d, withCtx as s, createTextVNode as b, toDisplayString as k, createElementVNode as i, unref as h, createVNode as w, withModifiers as z, createCommentVNode as P, normalizeClass as A, nextTick as R } from "vue";
import { ScalarTooltip as B, ScalarButton as M } from "@scalar/components";
import { requestExampleParametersSchema as x } from "@scalar/oas-utils/entities/spec";
import W from "../../../components/ViewLayout/ViewLayoutCollapse.vue.js";
import V from "./RequestTable.vue.js";
import { useWorkspace as D } from "../../../store/store.js";
const G = { class: "text-c-2 request-meta-buttons flex whitespace-nowrap opacity-0 group-hover/params:opacity-100 has-[:focus-visible]:opacity-100" }, U = { class: "sr-only" }, Z = /* @__PURE__ */ O({
  __name: "RequestParams",
  props: {
    example: {},
    environment: {},
    envVariables: {},
    workspace: {},
    title: {},
    paramKey: {},
    readOnlyEntries: { default: () => [] },
    invalidParams: {}
  },
  setup(t) {
    const { requestExampleMutators: r } = D(), l = m(() => t.example.parameters[t.paramKey] ?? []);
    T(() => v());
    const o = () => {
      const e = x.parse({ enabled: !1 }), a = [...l.value, e];
      r.edit(t.example.uid, `parameters.${t.paramKey}`, a);
    }, u = S(null), C = (e, a, y) => {
      const p = l.value;
      if (p.length > e) {
        const n = [...p];
        if (!n[e])
          return;
        n[e] = { ...n[e], [a]: y }, (n[e].key !== "" || n[e].value !== "") && (n[e].enabled = !0), n[e].key === "" && n[e].value === "" && n.splice(e, 1), r.edit(
          t.example.uid,
          `parameters.${t.paramKey}`,
          n
        );
      } else {
        const n = [x.parse({ [a]: y })];
        r.edit(t.example.uid, `parameters.${t.paramKey}`, n), R(() => {
          var g;
          if (!u.value)
            return;
          (g = u.value.querySelectorAll("input")[a === "key" ? 0 : 1]) == null || g.focus();
        });
      }
      e === p.length - 1 && o();
    }, q = (e, a) => r.edit(
      t.example.uid,
      `parameters.${t.paramKey}.${e}.enabled`,
      a
    ), E = () => {
      const e = l.value.filter((a) => a.required);
      r.edit(
        t.example.uid,
        `parameters.${t.paramKey}`,
        e
      ), R(() => o());
    };
    function v() {
      if (l.value.length === 0)
        o();
      else if (l.value.length >= 1) {
        const e = l.value[l.value.length - 1];
        e && e.key !== "" && e.value !== "" && o();
      }
    }
    const K = m(
      () => l.value.filter((e) => e.key || e.value).length
    ), $ = m(() => l.value.length > 1);
    N(
      () => t.example,
      (e, a) => {
        e !== a && v();
      },
      { immediate: !0 }
    );
    const f = m(() => (t.readOnlyEntries ?? []).length > 0);
    return (e, a) => (c(), d(W, {
      class: "group/params",
      itemCount: K.value
    }, {
      title: s(() => [
        b(k(e.title), 1)
      ]),
      actions: s(() => [
        i("div", G, [
          $.value ? (c(), d(h(B), {
            key: 0,
            side: "left",
            sideOffset: 6
          }, {
            trigger: s(() => [
              w(h(M), {
                class: "pr-0.75 pl-1 transition-none",
                size: "sm",
                variant: "ghost",
                onClick: z(E, ["stop"])
              }, {
                default: s(() => [
                  a[0] || (a[0] = b(" Clear ")),
                  i("span", U, "All " + k(e.title), 1)
                ]),
                _: 1
              })
            ]),
            content: s(() => a[1] || (a[1] = [
              i("div", { class: "w-content bg-b-1 text-xxs text-c-1 pointer-events-none z-10 grid min-w-48 gap-1.5 rounded p-2 leading-5 shadow-lg" }, [
                i("div", { class: "text-c-2 flex items-center" }, [
                  i("span", null, "Clear optional parameters")
                ])
              ], -1)
            ])),
            _: 1
          })) : P("", !0)
        ])
      ]),
      default: s(() => [
        i("div", {
          ref_key: "tableWrapperRef",
          ref: u
        }, [
          f.value ? (c(), d(V, {
            key: 0,
            class: A(["flex-1", {
              "bg-mix-transparent bg-mix-amount-95 bg-c-3": f.value
            }]),
            columns: ["32px", "", ""],
            envVariables: e.envVariables,
            environment: e.environment,
            invalidParams: e.invalidParams,
            isGlobal: "",
            isReadOnly: "",
            items: e.readOnlyEntries,
            workspace: e.workspace
          }, null, 8, ["class", "envVariables", "environment", "invalidParams", "items", "workspace"])) : P("", !0),
          w(V, {
            class: "flex-1",
            columns: ["32px", "", ""],
            envVariables: e.envVariables,
            environment: e.environment,
            invalidParams: e.invalidParams,
            items: l.value,
            workspace: e.workspace,
            onToggleRow: q,
            onUpdateRow: C
          }, null, 8, ["envVariables", "environment", "invalidParams", "items", "workspace"])
        ], 512)
      ]),
      _: 1
    }, 8, ["itemCount"]));
  }
});
export {
  Z as default
};
