import { defineComponent as ve, useCssVars as ge, computed as b, ref as be, resolveComponent as ye, openBlock as u, createElementBlock as C, normalizeClass as y, unref as n, createVNode as v, withCtx as c, createBlock as f, withModifiers as U, createElementVNode as s, toDisplayString as D, createCommentVNode as m, createTextVNode as E, renderSlot as Z, Fragment as _, renderList as he, nextTick as xe } from "vue";
import { ScalarButton as R, ScalarIcon as h, ScalarSidebarGroupToggle as ee, ScalarTooltip as te } from "@scalar/components";
import { Draggable as ke } from "@scalar/draggable";
import { shouldIgnoreEntity as ie } from "@scalar/oas-utils/helpers";
import { useRouter as we, RouterLink as ne } from "vue-router";
import { useLayout as Ue } from "../../hooks/useLayout.js";
import { useSidebar as qe } from "../../hooks/useSidebar.js";
import { useActiveEntities as Ce } from "../../store/active-entities.js";
import { PathId as S } from "../../routes.js";
import De from "../../components/HttpMethod/HttpMethod.vue.js";
import { getModifiers as Re } from "../../libs/hot-keys.js";
import { useWorkspace as Ie } from "../../store/store.js";
const Te = { class: "line-clamp-1 w-full break-all pl-2 font-medium" }, ze = { class: "flex flex-row items-center gap-1" }, Me = { class: "relative" }, $e = { class: "flex items-start" }, Ee = ["aria-expanded"], Se = { class: "flex flex-1 flex-row justify-between font-medium" }, Be = { class: "line-clamp-1 w-full break-all text-left" }, je = { class: "relative flex h-fit justify-end" }, We = { class: "w-content bg-b-1 z-100 text-xxs text-c-1 pointer-events-none z-10 grid max-w-10 gap-1.5 rounded p-2 leading-5 shadow-lg" }, Ae = { class: "text-c-2 flex items-center" }, Ne = { class: "text-pretty break-all" }, Oe = ["aria-expanded"], Pe = { class: "flex h-5 max-w-[14px] items-center justify-center" }, Ve = { class: "flex flex-1 flex-row justify-between" }, Fe = { class: "line-clamp-1 w-full break-all text-left font-medium" }, Ye = { class: "relative flex h-fit justify-end" }, He = { class: "w-content bg-b-1 z-100 text-xxs text-c-1 pointer-events-none z-10 grid max-w-10 gap-1.5 rounded p-2 leading-5 shadow-lg" }, Le = { class: "text-c-2 flex items-center" }, Ge = { class: "text-pretty break-all" }, Ke = { key: 3 }, P = "hover:bg-sidebar-active-b indent-padding-left", at = /* @__PURE__ */ ve({
  __name: "RequestSidebarItem",
  props: {
    isDraggable: { type: Boolean, default: !1 },
    isDroppable: { type: [Boolean, Function], default: !1 },
    parentUids: {},
    uid: {},
    menuItem: {}
  },
  emits: ["onDragEnd", "newTab", "openMenu"],
  setup(o, { emit: se }) {
    ge((e) => ({
      "0b708c94": re.value,
      "59b14f70": ue.value
    }));
    const oe = se, { activeCollection: le, activeRequest: V, activeRouterParams: ae, activeWorkspace: q } = Ce(), {
      collections: T,
      tags: z,
      requests: B,
      requestExamples: j,
      collectionMutators: W,
      tagMutators: F,
      requestMutators: A,
      requestExampleMutators: Y,
      events: H
    } = Ie(), x = we(), { collapsedSidebarFolders: I, toggleSidebarFolder: L } = qe(), { layout: p } = Ue(), i = b(() => {
      var g, l, d, k, $, Q;
      const e = T[o.uid], t = z[o.uid], r = B[o.uid], a = j[o.uid];
      return e ? {
        title: ((g = e.info) == null ? void 0 : g.title) || "Untitled Collection",
        entity: e,
        resourceTitle: "Collection",
        children: e.children,
        icon: e["x-scalar-icon"],
        documentUrl: e.documentUrl,
        watchMode: e.watchMode,
        to: e.uid && ((l = e == null ? void 0 : e.info) == null ? void 0 : l.title) !== "Drafts" ? {
          name: "collection",
          params: {
            [S.Workspace]: (d = q.value) == null ? void 0 : d.uid,
            [S.Collection]: e.uid
          }
        } : void 0,
        warning: "This cannot be undone. You’re about to delete the collection and all folders and requests inside it.",
        edit: (w, X) => {
          W.edit(e.uid, "info.title", w), X && W.edit(e.uid, "x-scalar-icon", X);
        },
        delete: () => {
          q.value && W.delete(e, q.value);
        }
      } : t ? {
        title: t.name,
        entity: t,
        resourceTitle: "Tag",
        children: t.children,
        warning: "This cannot be undone. You’re about to delete the tag and all requests inside it",
        edit: (w) => F.edit(t.uid, "name", w),
        delete: () => o.parentUids[0] && F.delete(t, o.parentUids[0])
      } : r ? {
        title: r.summary ?? r.path,
        to: {
          name: "request",
          params: {
            workspace: (k = q.value) == null ? void 0 : k.uid,
            request: r.uid
          }
        },
        method: r.method,
        entity: r,
        resourceTitle: "Request",
        warning: "This cannot be undone. You’re about to delete the request.",
        children: r.examples.slice(1),
        edit: (w) => A.edit(r.uid, "summary", w),
        delete: () => o.parentUids[0] && A.delete(r, o.parentUids[0])
      } : a != null && a.requestUid ? {
        title: a.name,
        to: {
          name: "request.examples",
          params: {
            workspace: ($ = q.value) == null ? void 0 : $.uid,
            request: a.requestUid,
            examples: a.uid
          }
        },
        method: (Q = B[a.requestUid]) == null ? void 0 : Q.method,
        entity: a,
        resourceTitle: "Example",
        warning: "This cannot be undone. You’re about to delete the example from the request.",
        children: [],
        edit: (w) => Y.edit(a.uid, "name", w),
        delete: () => Y.delete(a)
      } : {
        title: "Unknown",
        entity: {
          uid: "",
          type: "unknown"
        },
        resourceTitle: "Unknown",
        children: [],
        edit: () => null,
        delete: () => null
      };
    }), M = b(
      () => i.value.entity.type === "collection" && i.value.title === "Drafts"
    ), re = b(() => o.parentUids.length ? p === "modal" ? `${(o.parentUids.length - 1) * 12}px` : `${o.parentUids.length * 12}px` : "12px"), ue = b(() => o.parentUids.length ? p === "modal" ? `${(o.parentUids.length - 1) * 12}px` : `${o.parentUids.length * 12}px` : "0px"), de = b(
      () => {
        var e;
        return I[o.uid] || ((e = V.value) == null ? void 0 : e.uid) === o.uid && i.value.entity.examples.length > 1;
      }
    ), pe = b(
      () => {
        var e;
        return typeof x.currentRoute.value.name == "string" && x.currentRoute.value.name.startsWith("request") && ae.value[S.Request] === "default" && ((e = V.value) == null ? void 0 : e.uid) === o.uid;
      }
    ), N = be(null), G = b(() => {
      let e = 0.5, t = 0.5;
      if (!N.value)
        return { ceiling: e, floor: t };
      const { draggingItem: r } = N.value;
      return !T[r == null ? void 0 : r.id] && i.value.entity.type === "collection" ? (e = 1, t = 0) : i.value.entity.type === "tag" && (e = 0.8, t = 0.2), { ceiling: e, floor: t };
    }), ce = (e, t) => !(p === "modal" || j[t.id] || T[e.id]), fe = (e, t) => {
      e && (Re(["default"]).some((g) => e[g]) ? oe("newTab", t.title || "", t.entity.uid) : t.to && x.push(t.to), xe(() => H.focusAddressBar.emit()));
    };
    function O(e) {
      var g, l, d;
      const t = o.parentUids[0] ? ((g = T[o.parentUids[0]]) == null ? void 0 : g.uid) || "" : e, r = o.parentUids[0] && ((l = z[e]) != null && l.name) ? { tags: [z[e].name] } : {}, a = A.add(
        r,
        t
      );
      a && (x.push({
        name: "request",
        params: {
          workspace: (d = q.value) == null ? void 0 : d.uid,
          request: a.uid
        }
      }), H.hotKeys.emit({
        focusAddressBar: new KeyboardEvent("keydown", { key: "l" })
      }));
    }
    const K = b(() => {
      const { uid: e, watchModeStatus: t } = le.value || {};
      return e !== i.value.entity.uid ? "text-c-3" : t === "WATCHING" ? "text-c-1" : t === "ERROR" ? "text-red" : "text-c-3";
    }), J = b(() => i.value.title === "Drafts" && p !== "modal" && i.value.children.length > 0), me = b(() => {
      const e = B[o.uid];
      if (e)
        return !ie(e);
      const t = z[o.uid];
      return t ? !ie(t) : !0;
    });
    return (e, t) => {
      const r = ye("RequestSidebarItem", !0);
      return me.value ? (u(), C("li", {
        key: 0,
        class: y(["relative flex flex-row", [
          n(p) === "modal" && e.parentUids.length > 1 || n(p) !== "modal" && e.parentUids.length ? "before:bg-border indent-border-line-offset before:z-1 mb-[.5px] before:pointer-events-none before:absolute before:left-[calc(.75rem_+_.5px)] before:top-0 before:h-[calc(100%_+_.5px)] before:w-[.5px] last:mb-0 last:before:h-full" : ""
        ]])
      }, [
        v(n(ke), {
          id: i.value.entity.uid,
          ref_key: "draggableRef",
          ref: N,
          ceiling: G.value.ceiling,
          class: "gap-1/2 flex flex-1 flex-col text-sm",
          floor: G.value.floor,
          isDraggable: e.isDraggable,
          isDroppable: e.isDroppable,
          parentIds: e.parentUids,
          onOnDragEnd: t[13] || (t[13] = (...a) => e.$emit("onDragEnd", ...a))
        }, {
          default: c(() => {
            var a, g;
            return [
              (i.value.entity.type === "request" || i.value.entity.type === "requestExample") && i.value.to ? (u(), f(n(ne), {
                key: 0,
                class: "group no-underline",
                to: i.value.to,
                onClick: t[1] || (t[1] = U(
                  (l) => fe(l, i.value),
                  ["prevent"]
                ))
              }, {
                default: c(({ isExactActive: l }) => {
                  var d, k;
                  return [
                    s("div", {
                      class: y(["relative flex min-h-8 w-full cursor-pointer flex-row items-start justify-between gap-0.5 rounded py-1.5 pr-2", [
                        P,
                        l || pe.value ? "bg-sidebar-active-b text-sidebar-active-c transition-none" : "text-sidebar-c-2"
                      ]])
                    }, [
                      s("span", Te, D(i.value.title || "Untitled"), 1),
                      s("div", ze, [
                        s("div", Me, [
                          n(p) !== "modal" ? (u(), f(n(R), {
                            key: 0,
                            class: y(["hover:bg-b-3 hidden aspect-square h-fit px-0.5 py-0 opacity-0 group-hover:flex group-hover:opacity-100 group-focus-visible:opacity-100 group-has-[:focus-visible]:opacity-100", {
                              flex: ((k = (d = e.menuItem) == null ? void 0 : d.item) == null ? void 0 : k.entity.uid) === i.value.entity.uid && e.menuItem.open
                            }]),
                            size: "sm",
                            type: "button",
                            variant: "ghost",
                            onClick: t[0] || (t[0] = U(
                              ($) => e.$emit("openMenu", {
                                item: i.value,
                                parentUids: e.parentUids,
                                targetRef: $.currentTarget,
                                open: !e.menuItem.open
                              }),
                              ["stop", "prevent"]
                            ))
                          }, {
                            default: c(() => [
                              v(n(h), {
                                icon: "Ellipses",
                                size: "md"
                              })
                            ]),
                            _: 1
                          }, 8, ["class"])) : m("", !0)
                        ]),
                        s("span", $e, [
                          t[14] || (t[14] = E("   ")),
                          t[15] || (t[15] = s("span", { class: "sr-only" }, "HTTP Method:", -1)),
                          i.value.method ? (u(), f(n(De), {
                            key: 0,
                            class: "font-bold",
                            method: i.value.method
                          }, null, 8, ["method"])) : m("", !0)
                        ])
                      ])
                    ], 2)
                  ];
                }),
                _: 1
              }, 8, ["to"])) : (n(p) !== "modal" || e.parentUids.length) && i.value.entity.type === "collection" ? (u(), C("div", {
                key: 1,
                "aria-expanded": !!n(I)[i.value.entity.uid],
                class: y(["hover:bg-b-2 group relative flex w-full flex-row justify-start gap-1.5 rounded p-1.5 focus-visible:z-10", [
                  P,
                  {
                    "bg-sidebar-active-b text-sidebar-active-c transition-none": typeof n(x).currentRoute.value.name == "string" && n(x).currentRoute.value.name.startsWith("collection") && n(x).currentRoute.value.params[n(S).Collection] === i.value.entity.uid,
                    "text-c-2": i.value.title === "Untitled Collection"
                  }
                ]])
              }, [
                s("span", {
                  class: "flex h-5 max-w-[14px] cursor-pointer items-center justify-center",
                  onClick: t[2] || (t[2] = (l) => n(L)(i.value.entity.uid))
                }, [
                  Z(e.$slots, "leftIcon", {}, () => [
                    v(n(ee), {
                      class: "text-c-3 shrink-0",
                      open: !!n(I)[i.value.entity.uid]
                    }, null, 8, ["open"])
                  ], !0),
                  t[16] || (t[16] = E("   "))
                ]),
                s("div", Se, [
                  i.value.to ? (u(), f(n(ne), {
                    key: 0,
                    class: "w-full no-underline",
                    to: i.value.to,
                    onClick: t[3] || (t[3] = U(() => {
                    }, ["stop", "prevent"]))
                  }, {
                    default: c(() => [
                      s("span", Be, D(i.value.title), 1)
                    ]),
                    _: 1
                  }, 8, ["to"])) : (u(), C(_, { key: 1 }, [
                    E(D(i.value.title), 1)
                  ], 64)),
                  s("div", je, [
                    s("div", {
                      class: y(["items-center gap-px opacity-0 group-hover:flex group-hover:opacity-100 group-focus-visible:opacity-100 group-has-[:focus-visible]:opacity-100", {
                        flex: e.menuItem.open,
                        hidden: !e.menuItem.open || ((a = e.menuItem.item) == null ? void 0 : a.entity.uid) !== i.value.entity.uid
                      }])
                    }, [
                      n(p) !== "modal" && !M.value || M.value && J.value ? (u(), f(n(R), {
                        key: 0,
                        class: "hover:bg-b-3 hover:text-c-1 aspect-square h-fit px-0.5 py-0 group-focus-visible:opacity-100 group-has-[:focus-visible]:opacity-100",
                        size: "sm",
                        variant: "ghost",
                        onClick: t[4] || (t[4] = U(
                          (l) => e.$emit("openMenu", {
                            item: i.value,
                            parentUids: e.parentUids,
                            targetRef: l.currentTarget.parentNode,
                            open: !0
                          }),
                          ["stop", "prevent"]
                        ))
                      }, {
                        default: c(() => [
                          v(n(h), {
                            icon: "Ellipses",
                            size: "md"
                          })
                        ]),
                        _: 1
                      })) : m("", !0),
                      n(p) !== "modal" ? (u(), f(n(R), {
                        key: 1,
                        class: "hover:bg-b-3 hover:text-c-1 aspect-square h-fit px-0.5 py-0 group-focus-visible:opacity-100 group-has-[:focus-visible]:opacity-100",
                        size: "sm",
                        variant: "ghost",
                        onClick: t[5] || (t[5] = U((l) => O(i.value.entity.uid), ["stop", "prevent"]))
                      }, {
                        default: c(() => [
                          v(n(h), {
                            icon: "Add",
                            size: "md",
                            thickness: "2"
                          })
                        ]),
                        _: 1
                      })) : m("", !0)
                    ], 2),
                    i.value.watchMode ? (u(), f(n(te), {
                      key: 0,
                      side: "right",
                      sideOffset: 12
                    }, {
                      trigger: c(() => [
                        v(n(h), {
                          class: y(["ml-0.5 text-sm", K.value]),
                          icon: "Watch",
                          size: "md",
                          thickness: "2"
                        }, null, 8, ["class"])
                      ]),
                      content: c(() => [
                        s("div", We, [
                          s("div", Ae, [
                            s("p", Ne, " Watching: " + D(i.value.documentUrl), 1)
                          ])
                        ])
                      ]),
                      _: 1
                    })) : m("", !0),
                    t[17] || (t[17] = s("span", null, " ", -1))
                  ])
                ])
              ], 10, Ee)) : n(p) !== "modal" || e.parentUids.length ? (u(), C("button", {
                key: 2,
                "aria-expanded": !!n(I)[i.value.entity.uid],
                class: y(["hover:bg-b-2 group relative flex w-full flex-row justify-start gap-1.5 rounded p-1.5 focus-visible:z-10", [P]]),
                type: "button",
                onClick: t[8] || (t[8] = (l) => n(L)(i.value.entity.uid))
              }, [
                s("span", Pe, [
                  Z(e.$slots, "leftIcon", {}, () => [
                    v(n(ee), {
                      class: "text-c-3 hover:text-c-1 shrink-0",
                      open: !!n(I)[i.value.entity.uid]
                    }, null, 8, ["open"])
                  ], !0),
                  t[18] || (t[18] = E("   "))
                ]),
                s("div", Ve, [
                  s("span", Fe, D(i.value.title), 1),
                  s("div", Ye, [
                    s("div", {
                      class: y(["items-center gap-px opacity-0 group-hover:flex group-hover:opacity-100 group-focus-visible:opacity-100 group-has-[:focus-visible]:opacity-100", {
                        flex: e.menuItem.open,
                        hidden: !e.menuItem.open || ((g = e.menuItem.item) == null ? void 0 : g.entity.uid) !== i.value.entity.uid
                      }])
                    }, [
                      n(p) !== "modal" && !M.value || M.value && J.value ? (u(), f(n(R), {
                        key: 0,
                        class: "hover:bg-b-3 hover:text-c-1 aspect-square h-fit px-0.5 py-0 group-focus-visible:opacity-100 group-has-[:focus-visible]:opacity-100",
                        size: "sm",
                        variant: "ghost",
                        onClick: t[6] || (t[6] = U(
                          (l) => e.$emit("openMenu", {
                            item: i.value,
                            parentUids: e.parentUids,
                            targetRef: l.currentTarget.parentNode,
                            open: !0
                          }),
                          ["stop", "prevent"]
                        ))
                      }, {
                        default: c(() => [
                          v(n(h), {
                            icon: "Ellipses",
                            size: "md"
                          })
                        ]),
                        _: 1
                      })) : m("", !0),
                      n(p) !== "modal" ? (u(), f(n(R), {
                        key: 1,
                        class: "hover:bg-b-3 hover:text-c-1 aspect-square h-fit px-0.5 py-0 group-focus-visible:opacity-100 group-has-[:focus-visible]:opacity-100",
                        size: "sm",
                        variant: "ghost",
                        onClick: t[7] || (t[7] = U((l) => O(i.value.entity.uid), ["stop", "prevent"]))
                      }, {
                        default: c(() => [
                          v(n(h), {
                            icon: "Add",
                            size: "md",
                            thickness: "2"
                          })
                        ]),
                        _: 1
                      })) : m("", !0)
                    ], 2),
                    i.value.watchMode ? (u(), f(n(te), {
                      key: 0,
                      side: "right",
                      sideOffset: 12
                    }, {
                      trigger: c(() => [
                        v(n(h), {
                          class: y(["ml-0.5 text-sm", K.value]),
                          icon: "Watch",
                          size: "md",
                          thickness: "2"
                        }, null, 8, ["class"])
                      ]),
                      content: c(() => [
                        s("div", He, [
                          s("div", Le, [
                            s("p", Ge, " Watching: " + D(i.value.documentUrl), 1)
                          ])
                        ])
                      ]),
                      _: 1
                    })) : m("", !0),
                    t[19] || (t[19] = s("span", null, " ", -1))
                  ])
                ])
              ], 10, Oe)) : m("", !0),
              de.value ? (u(), C("ul", Ke, [
                (u(!0), C(_, null, he(i.value.children, (l) => (u(), f(r, {
                  key: l,
                  isDraggable: !n(j)[l],
                  isDroppable: ce,
                  menuItem: e.menuItem,
                  parentUids: [...e.parentUids, e.uid],
                  uid: l,
                  onNewTab: t[9] || (t[9] = (d, k) => e.$emit("newTab", d, k)),
                  onOnDragEnd: t[10] || (t[10] = (...d) => e.$emit("onDragEnd", ...d)),
                  onOpenMenu: t[11] || (t[11] = (d) => e.$emit("openMenu", d))
                }, null, 8, ["isDraggable", "menuItem", "parentUids", "uid"]))), 128)),
                i.value.children.length === 0 ? (u(), f(n(R), {
                  key: 0,
                  class: y(["text-c-1 hover:bg-b-2 flex h-8 w-full justify-start gap-1.5 py-0 text-xs", e.parentUids.length ? "pl-9" : ""]),
                  variant: "ghost",
                  onClick: t[12] || (t[12] = (l) => O(i.value.entity.uid))
                }, {
                  default: c(() => [
                    v(n(h), {
                      icon: "Add",
                      size: "sm"
                    }),
                    t[20] || (t[20] = s("span", null, "Add Request", -1))
                  ]),
                  _: 1
                }, 8, ["class"])) : m("", !0)
              ])) : m("", !0)
            ];
          }),
          _: 3
        }, 8, ["id", "ceiling", "floor", "isDraggable", "isDroppable", "parentIds"])
      ], 2)) : m("", !0);
    };
  }
});
export {
  at as default
};
