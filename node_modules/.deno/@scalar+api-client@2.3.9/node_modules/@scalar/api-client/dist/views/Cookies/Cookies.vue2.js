import { defineComponent as K, onMounted as L, onBeforeUnmount as V, computed as h, openBlock as n, createBlock as d, withCtx as a, createVNode as r, unref as u, createElementVNode as b, createElementBlock as y, Fragment as j, renderList as A, withModifiers as O, createTextVNode as w } from "vue";
import { useModal as H } from "@scalar/components";
import { cookieSchema as I } from "@scalar/oas-utils/entities/cookie";
import { useRouter as R, useRoute as W } from "vue-router";
import D from "../../components/EmptyState.vue.js";
import F from "../../components/Sidebar/SidebarButton.vue.js";
import P from "../../components/Sidebar/SidebarList.vue.js";
import T from "../../components/Sidebar/SidebarListElement.vue.js";
import U from "../../components/ViewLayout/ViewLayout.vue.js";
import q from "../../components/ViewLayout/ViewLayoutContent.vue.js";
import z from "../../components/ViewLayout/ViewLayoutSection.vue.js";
import { PathId as x } from "../../routes.js";
import G from "./CookieForm.vue.js";
import J from "./CookieModal.vue.js";
import { useActiveEntities as Q } from "../../store/active-entities.js";
import { useWorkspace as X } from "../../store/store.js";
import Y from "../../components/Sidebar/Sidebar.vue.js";
const Z = { class: "flex-1" }, ee = { class: "relative mb-[.5px] last:mb-0" }, he = /* @__PURE__ */ K({
  __name: "Cookies",
  setup(oe) {
    const { cookies: c, cookieMutators: p, events: k, workspaceMutators: v } = X(), { activeWorkspace: l, activeCookieId: g } = Q(), m = R(), M = W(), f = H(), E = (t) => {
      var e, i;
      const o = I.parse({
        name: t.name,
        value: t.value,
        domain: t.domain,
        path: "/"
      });
      p.add(o), v.edit((e = l.value) == null ? void 0 : e.uid, "cookies", [
        ...((i = l.value) == null ? void 0 : i.cookies) ?? [],
        o.uid
      ]), m.push({
        name: "cookies",
        params: {
          cookies: o.uid
        }
      });
    }, N = (t) => {
      var e, i;
      p.delete(t), v.edit((e = l.value) == null ? void 0 : e.uid, "cookies", [
        ...(((i = l.value) == null ? void 0 : i.cookies) ?? []).filter((s) => s !== t)
      ]);
      const o = Object.values(c).filter(
        (s) => s.uid !== t
      );
      if (o.length > 0) {
        const s = o[o.length - 1];
        s && m.push(s.uid);
      } else
        m.push({
          name: "cookies",
          params: {
            [x.Cookies]: "default"
          }
        });
    }, C = () => {
      f.show();
    }, _ = (t) => {
      t != null && t.createNew && M.name === "cookies" && C();
    }, S = (t, o) => {
      var i;
      const e = {
        name: "cookies",
        params: {
          workspace: ((i = l.value) == null ? void 0 : i.uid) ?? "default",
          cookies: o
        }
      };
      if (t.metaKey) {
        const s = m.resolve(e).href;
        window.open(s, "_blank");
        return;
      }
      m.push(e);
    };
    L(() => k.hotKeys.on(_)), V(() => k.hotKeys.off(_));
    const $ = h(
      () => c[g.value]
    ), B = h(
      () => Object.keys(c).length > 0 && $.value
    );
    return (t, o) => (n(), d(U, null, {
      default: a(() => [
        r(u(Y), { title: "Cookies" }, {
          content: a(() => [
            b("div", Z, [
              r(P, null, {
                default: a(() => [
                  (n(!0), y(j, null, A(Object.values(u(c)), (e) => (n(), y("li", {
                    key: e.uid,
                    class: "gap-1/2 flex flex-col"
                  }, [
                    b("div", ee, [
                      (n(), d(T, {
                        key: e.uid,
                        class: "text-xs",
                        isDeletable: "",
                        to: {
                          name: "cookies",
                          params: {
                            [u(x).Cookies]: e.uid
                          }
                        },
                        type: "cookies",
                        variable: { name: e.name, uid: e.uid },
                        warningMessage: "Are you sure you want to delete this cookie?",
                        onClick: O((i) => S(i, e.uid), ["prevent"]),
                        onDelete: (i) => N(e.uid)
                      }, null, 8, ["to", "variable", "onClick", "onDelete"]))
                    ])
                  ]))), 128))
                ]),
                _: 1
              })
            ])
          ]),
          button: a(() => [
            r(F, {
              click: C,
              hotkey: "N"
            }, {
              title: a(() => o[1] || (o[1] = [
                w(" Add Cookie ")
              ])),
              _: 1
            })
          ]),
          _: 1
        }),
        r(q, { class: "flex-1" }, {
          default: a(() => [
            B.value ? (n(), d(z, {
              key: 0,
              class: "*:border-b-0"
            }, {
              title: a(() => o[2] || (o[2] = [
                w("Edit Cookie")
              ])),
              default: a(() => [
                r(G)
              ]),
              _: 1
            })) : (n(), d(D, { key: 1 }))
          ]),
          _: 1
        }),
        r(J, {
          state: u(f),
          onCancel: o[0] || (o[0] = (e) => u(f).hide()),
          onSubmit: E
        }, null, 8, ["state"])
      ]),
      _: 1
    }));
  }
});
export {
  he as default
};
